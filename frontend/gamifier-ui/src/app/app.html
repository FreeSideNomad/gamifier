<!-- Multi-Theme Application Layout -->
<div
  [class]="isCorporateTheme() ? 'theme-corporate corporate-app-container' : 'lcars-app-container'"
  (click)="onUserInteraction()">
  <!-- LCARS Header -->
  <header class="lcars-header">
    <div class="header-content">
      <h1 class="app-title">{{ appTitle }}</h1>
      <div class="header-controls">
        <!-- Theme Switcher -->
        <button
          [class]="isCorporateTheme() ? 'btn-corporate btn-secondary' : 'lcars-button secondary'"
          (click)="switchTheme()"
          (mouseenter)="playHoverSound()">
          @if (isStarfleetTheme()) {
            ğŸ–– Star Trek
          } @else {
            ğŸ¢ Corporate
          }
        </button>

        <!-- Audio Toggle -->
        <button
          [class]="isCorporateTheme() ? 'btn-corporate btn-secondary' : 'lcars-button secondary'"
          (click)="toggleAudio()"
          [disabled]="!currentTheme().enableSounds">
          {{ audioEnabled() ? 'ğŸ”Š' : 'ğŸ”‡' }} Audio
        </button>

        <div class="user-info" *ngIf="currentUser()">
          <span [class]="isCorporateTheme() ? 'badge-corporate badge-primary' : 'rank-badge lcars-badge rank'">
            {{ currentUser()?.rank }}
          </span>
          <span class="user-name">{{ currentUser()?.name }}</span>
          <span [class]="isCorporateTheme() ? 'text-corporate text-primary' : 'points lcars-text-amber'">
            {{ currentUser()?.points }} PTS
          </span>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content Area -->
  <div class="lcars-main-layout">
    <!-- LCARS Navigation Sidebar -->
    <nav class="lcars-nav" *ngIf="!isLoading">
      <div class="nav-section">
        <h3 class="nav-title">System Access</h3>

        <a routerLink="/dashboard"
           routerLinkActive="active"
           class="nav-item"
           (mouseenter)="playHoverSound()"
           (click)="playClickSound()">
          ğŸ“Š Dashboard
        </a>

        <a routerLink="/missions"
           routerLinkActive="active"
           class="nav-item"
           (mouseenter)="playHoverSound()"
           (click)="playClickSound()">
          ğŸ¯ Missions
        </a>

        <a routerLink="/leaderboards"
           routerLinkActive="active"
           class="nav-item"
           (mouseenter)="playHoverSound()"
           (click)="playClickSound()">
          ğŸ† Leaderboards
        </a>

        <a routerLink="/actions"
           routerLinkActive="active"
           class="nav-item"
           (mouseenter)="playHoverSound()"
           (click)="playClickSound()">
          âš¡ Actions
        </a>
      </div>

      <div class="nav-section" *ngIf="isAdmin">
        <h3 class="nav-title">Admin Functions</h3>

        <a routerLink="/admin/users"
           routerLinkActive="active"
           class="nav-item"
           (mouseenter)="playHoverSound()"
           (click)="playClickSound()">
          ğŸ‘¥ User Management
        </a>

        <a routerLink="/admin/organization"
           routerLinkActive="active"
           class="nav-item"
           (mouseenter)="playHoverSound()"
           (click)="playClickSound()">
          ğŸ¢ Organization
        </a>

        <a routerLink="/admin/reports"
           routerLinkActive="active"
           class="nav-item"
           (mouseenter)="playHoverSound()"
           (click)="playClickSound()">
          ğŸ“ˆ Reports
        </a>
      </div>

      <!-- System Status Panel -->
      <div class="system-status lcars-panel accent-blue">
        <h4 class="lcars-text-blue">System Status</h4>
        <div class="status-item">
          <span class="status-label">Connection:</span>
          <span class="status-value" [class]="connectionStatus()">
            {{ connectionStatus().toUpperCase() }}
          </span>
        </div>
        <div class="status-item">
          <span class="status-label">Users Online:</span>
          <span class="status-value lcars-text-amber">{{ onlineUsers() }}</span>
        </div>
        <div class="status-item">
          <span class="status-label">System Load:</span>
          <div class="lcars-progress">
            <div class="progress-bar" [style.width.%]="systemLoad()"></div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Content Area -->
    <main class="content-area">
      <!-- Loading Screen -->
      <div class="loading-screen lcars-fade-in" *ngIf="isLoading()">
        <div class="loading-content">
          <h2 class="lcars-text-amber">ACCESSING STARFLEET DATABASE</h2>
          <div class="loading-bars">
            <div class="loading-bar" *ngFor="let bar of loadingBars"
                 [style.animation-delay.ms]="bar * 100"></div>
          </div>
          <p class="loading-text">{{ loadingMessage() }}</p>
        </div>
      </div>

      <!-- Router Outlet -->
      <div class="page-content lcars-fade-in" *ngIf="!isLoading()">
        <router-outlet></router-outlet>
      </div>

      <!-- Notification Panel -->
      <div class="notification-panel" *ngIf="notifications().length > 0">
        <div class="notification lcars-panel"
             *ngFor="let notification of notifications(); trackBy: trackByNotificationId"
             [class]="'accent-' + notification.type">
          <div class="notification-content">
            <h4>{{ notification.title }}</h4>
            <p>{{ notification.message }}</p>
            <button class="lcars-button primary"
                    (click)="dismissNotification(notification.id)">
              Acknowledge
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- LCARS Footer -->
  <footer class="lcars-footer">
    <div class="footer-content">
      <div class="footer-left">
        <span class="lcars-text-secondary">Starfleet Gamification System</span>
        <span class="version">v{{ version }}</span>
      </div>
      <div class="footer-center">
        <span class="stardate">Stardate: {{ stardate() }}</span>
      </div>
      <div class="footer-right">
        <span class="lcars-text-secondary">{{ currentTime() | date:'HH:mm:ss' }}</span>
      </div>
    </div>
  </footer>
</div>

<!-- Audio Controls (Hidden) -->
<audio #audioElement preload="none"></audio>